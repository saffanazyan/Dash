<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icon Page bar -->
  <link rel="icon" sizes="192x192" href="images/logo.png" type="image/x-icon"/>
  <link rel="shortcut icon" href="images/logo.png" type="image/x-icon"/>
  <link rel="apple-touch-icon" href="images/logo.png" type="image/x-icon"/>
    
    <!-- ===== Iconscout CSS ===== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <!-- ===== CSS ===== -->
    <link rel="stylesheet" href="style.css">
  <title>verify RT RedCap </title> 
</head>
<body>
<div class="container">
    <div class="forms">
      <div class="form verify">
    <span class="title">verification</span>

    <form id="verifyForm" action="#" method="POST">
        <!-- ... other input fields ... -->

        <div class="input-field">
            <input id="verificationCode" type="text" placeholder="Enter verification code" required>
            <i class="uil uil-key icon"></i>
        </div>

        <div class="input-field button">
            <input type="button" value="Verify Code" id="verifyCodeButton">
        </div>
        
        <!-- Add a hidden field to store the email during the registration process -->
        <input type="hidden" id="hiddenEmail" name="hiddenEmail" value="">
    </form>
    </div>
</div>
<script>
    async function verifyUser() {
    const verificationCode = document.getElementById('verificationCode').value;

    // Validate verification code (add additional validation if needed)
    if (!verificationCode) {
        alert('Please enter verification code');
        return;
    }

    const requestBody = {
        s_verify: verificationCode,
    };

    try {
        const response = await fetch('https://140.118.121.85:5000/user/verify', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestBody),
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log('verify response:', data);

        if (data.message === 'User found' || data.status_code === 200) {
            console.log('Verification successful:', data.message);
            window.location.href = 'index.html';
        } else {
            console.error('Verification failed:', data.message);
            alert('Verification failed. Please check your email!');
        }
    } catch (error) {
        console.error('Error during fetch operation:', error);
        alert('An error occurred during verification. Please try again later.');
    }
}

document.getElementById('verifyCodeButton').addEventListener('click', verifyUser);

</script>    
<!--script>
  /*document.addEventListener("DOMContentLoaded", () => {
    //const signUp = document.getElementById("signUp");
    //const login = document.getElementById("login");
    const verifyCodeButton = document.getElementById("verifyCodeButton");
    const container = document.querySelector(".container");

    /*signUp.addEventListener("click", () => {
        container.classList.add("active");
    });

    login.addEventListener("click", () => {
        container.classList.remove("active");
    });*/

    // Handle the click event on the "Verify Code" button
    verifyCodeButton.addEventListener("click", () => {
        // Assuming you have the user's email stored somewhere
        const userEmail = document.getElementById("hiddenEmail").value;
        
        // Get the verification code from the input field
        const verificationCode = document.getElementById("verificationCode").value;

        // Perform verification on the server-side
        // Send the userEmail and verificationCode to your server for validation

        // Example using fetch:
        fetch("http://140.118.121.85:5000/user/verify", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ email: userEmail, code: verificationCode }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Verification successful. You can now complete the registration.");
                // Redirect or perform additional actions as needed
            } else {
                alert("Verification failed. Please check your code and try again.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
        });
    });
});

</script--> 
</body>
</html>
      
